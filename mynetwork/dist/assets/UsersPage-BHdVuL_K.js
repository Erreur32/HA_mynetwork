import{s as N,r as u,j as e,E as b}from"./index-D769t3SB.js";import{r as c}from"./vendor-charts-fy94SsLU.js";import{a as y,aS as v,R as E,U as C,a8 as z}from"./vendor-icons-Wr2_Nvt-.js";import"./vendor-D9iDNHsv.js";import"./vendor-state-CiM9n9np.js";const M=({onBack:g})=>{const{user:t}=N(),[h,p]=c.useState([]),[f,d]=c.useState(!0),[x,o]=c.useState(null);c.useEffect(()=>{(t==null?void 0:t.role)==="admin"&&m()},[t]);const m=async()=>{var a,l,n;d(!0),o(null);try{const r=await u.get("/api/users");if(r.success&&r.result)p(r.result);else{const s=((a=r.error)==null?void 0:a.message)||"Échec du chargement des utilisateurs";o(s)}}catch(r){let s="Échec du chargement des utilisateurs";r.message?r.message.includes("socket")||r.message.includes("ended")||r.message.includes("ECONNRESET")?s="Connexion interrompue. Veuillez réessayer.":r.message.includes("timeout")||r.message.includes("TIMEOUT")?s="La requête a expiré. Veuillez réessayer.":(l=r.error)!=null&&l.message?s=r.error.message:s=r.message:(n=r.error)!=null&&n.message&&(s=r.error.message),o(s)}finally{d(!1)}},j=async a=>{var l,n,r;if(confirm("Voulez-vous vraiment supprimer cet utilisateur ?"))try{const s=await u.delete(`/api/users/${a}`);if(s.success)await m();else{const i=((l=s.error)==null?void 0:l.message)||"Échec de la suppression";alert(i)}}catch(s){let i="Échec de la suppression";s.message?s.message.includes("socket")||s.message.includes("ended")||s.message.includes("ECONNRESET")?i="Connexion interrompue. Veuillez réessayer.":s.message.includes("timeout")||s.message.includes("TIMEOUT")?i="La requête a expiré. Veuillez réessayer.":(n=s.error)!=null&&n.message?i=s.error.message:i=s.message:(r=s.error)!=null&&r.message&&(i=s.error.message),alert(i)}};return(t==null?void 0:t.role)!=="admin"?e.jsx("div",{className:"min-h-screen bg-[#050505] text-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{size:48,className:"mx-auto text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Accès administrateur requis"})]})}):e.jsx("div",{className:"min-h-screen bg-[#050505] text-gray-300",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:g,className:"p-2 hover:bg-[#1a1a1a] rounded transition-colors",children:e.jsx(v,{size:20})}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Gestion des Utilisateurs"}),e.jsx("button",{onClick:m,className:"ml-auto p-2 hover:bg-[#1a1a1a] rounded transition-colors",title:"Actualiser",children:e.jsx(E,{size:20})})]}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-700 rounded text-red-400 text-sm",children:x}),f?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Chargement..."}):e.jsx("div",{className:"grid gap-4",children:h.map(a=>e.jsx(b,{title:a.username,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"font-medium",children:a.username}),a.role==="admin"&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-900/30 border border-blue-700 rounded text-xs text-blue-400",children:"Admin"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:a.email}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Créé le ",new Date(a.createdAt).toLocaleDateString("fr-FR")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:a.id!==(t==null?void 0:t.id)&&e.jsx("button",{onClick:()=>j(a.id),className:"p-2 hover:bg-red-900/20 rounded text-red-400 hover:text-red-300 transition-colors",title:"Supprimer",children:e.jsx(z,{size:16})})})]})},a.id))})]})})};export{M as UsersPage};
