import{q as F,b as d,g as v,j as e,E as P,T as E,L as M}from"./index-D769t3SB.js";import{r as a}from"./vendor-charts-fy94SsLU.js";import{aS as I,R as S,_ as x,a0 as C,m as O,Y as V}from"./vendor-icons-Wr2_Nvt-.js";import"./vendor-D9iDNHsv.js";import"./vendor-state-CiM9n9np.js";const _=({onBack:m,onNavigateToSettings:g})=>{const{plugins:n,isLoading:w,fetchPlugins:i,updatePluginConfig:T,testPluginConnection:L}=F(),{checkAuth:l,isRegistered:h,isLoggedIn:c}=d(),{capabilities:q,fetchCapabilities:f}=v(),[b,j]=a.useState(null),[z,r]=a.useState(!1);a.useEffect(()=>{i()},[i]),a.useEffect(()=>{const s=n.find(t=>t.id==="freebox");s!=null&&s.enabled&&(s!=null&&s.connectionStatus)&&c&&f()},[n,c,f]),a.useEffect(()=>{const s=n.find(t=>t.id==="freebox");s!=null&&s.enabled?l().then(()=>{const t=d.getState();!t.isRegistered&&!t.isRegistering?r(!0):t.isRegistered&&t.isLoggedIn&&r(!1)}):r(!1)},[n,l]),a.useEffect(()=>{h&&c&&(r(!1),i())},[h,c,i]);const A=async(s,t)=>{await T(s,{enabled:t}),await i(),s==="freebox"&&t?(await l(),d.getState().isRegistered||r(!0)):s==="freebox"&&!t&&r(!1)},[u,p]=a.useState(null),[o,N]=a.useState(null),k=async s=>{j(s);const t=await L(s);t?(N(t.connected),p(t.message)):(N(!1),p("Test de connexion impossible (voir logs backend)")),setTimeout(()=>j(null),2e3),await i()};return e.jsx("div",{className:"min-h-screen bg-[#050505] text-gray-300",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:m,className:"p-2 hover:bg-[#1a1a1a] rounded transition-colors",children:e.jsx(I,{size:20})}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Gestion des Plugins"}),e.jsx("button",{onClick:()=>i(),className:"ml-auto p-2 hover:bg-[#1a1a1a] rounded transition-colors",title:"Actualiser",children:e.jsx(S,{size:20})})]}),w?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Chargement..."}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u&&e.jsxs("div",{className:`md:col-span-2 mb-4 px-4 py-3 rounded-lg border-2 flex items-center gap-3 ${o?"border-green-600 bg-green-900/40 text-green-100":"border-red-600 bg-red-900/40 text-red-100"}`,children:[o?e.jsx(x,{size:18,className:"text-green-400 flex-shrink-0"}):e.jsx(C,{size:18,className:"text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm mb-0.5",children:o?"Test de connexion réussi":"Test de connexion échoué"}),e.jsx("div",{className:"text-xs opacity-90",children:u})]})]}),n.map(s=>e.jsx(P,{title:s.name,actions:e.jsx("div",{className:"flex items-center gap-2",children:s.connectionStatus?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400 px-2 py-1 bg-emerald-500/20 border border-emerald-500/30 rounded",children:[e.jsx(x,{size:12}),"Connecté"]}):s.enabled?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-yellow-400 px-2 py-1 bg-yellow-500/20 border border-yellow-500/30 rounded",children:[e.jsx(V,{size:12}),"Non connecté"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 px-2 py-1 bg-gray-500/20 border border-gray-500/30 rounded",children:[e.jsx(C,{size:12}),"Désactivé"]})}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Version ",s.version]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>k(s.id),disabled:b===s.id,className:"p-2 hover:bg-[#1a1a1a] rounded transition-colors disabled:opacity-50",title:"Tester la connexion",children:e.jsx(S,{size:16,className:b===s.id?"animate-spin":""})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-700",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Activer"}),e.jsx(E,{checked:s.enabled,onChange:t=>A(s.id,t)})]}),s.id!=="freebox"&&e.jsxs("button",{onClick:()=>{sessionStorage.setItem("adminMode","true"),sessionStorage.setItem("adminTab","plugins"),g?g():m()},className:"w-full mt-3 px-3 py-2 bg-[#1a1a1a] hover:bg-[#252525] border border-gray-700 rounded-lg text-sm text-gray-300 hover:text-white transition-colors flex items-center justify-center gap-2",children:[e.jsx(O,{size:14}),"Configurer"]}),s.id==="freebox"&&e.jsx("div",{className:"pt-2 border-t border-gray-700 space-y-2",children:s.enabled&&s.connectionStatus&&c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(x,{size:12,className:"text-green-400"}),e.jsx("span",{className:"text-green-400",children:"Connecté"})]}),(()=>{const t=v.getState().capabilities,y=(t==null?void 0:t.modelName)||"Freebox",R=t?"API v8+":"API v6/v7";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Modèle:"}),e.jsx("span",{className:"text-gray-300",children:y})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"API:"}),e.jsx("span",{className:"text-gray-300",children:R})]})]})})()]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Le plugin Freebox nécessite une configuration via l'API Freebox."})}),s.id==="unifi"&&!s.enabled&&e.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-700",children:"Configurez l'URL, le nom d'utilisateur et le mot de passe pour activer ce plugin."})]})},s.id))]}),e.jsx(M,{isOpen:z})]})})};export{_ as PluginsPage};
