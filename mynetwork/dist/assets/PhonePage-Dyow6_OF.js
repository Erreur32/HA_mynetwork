import{c as G,b as H,j as e}from"./index-D769t3SB.js";import{r as u,R as K}from"./vendor-charts-fy94SsLU.js";import{P as T}from"./PermissionBanner-DQzGv1X1.js";import{af as R,P as j,c as X,z as Z,b as A,am as ee,a8 as v,O as se,Y as te,a2 as q,U as re,an as ae,ao as ne,ap as le}from"./vendor-icons-Wr2_Nvt-.js";import"./vendor-D9iDNHsv.js";import"./vendor-state-CiM9n9np.js";const ie=s=>{const n=Date.now()/1e3-s;return n<60?"À l'instant":n<3600?`Il y a ${Math.floor(n/60)}min`:n<86400?`Il y a ${Math.floor(n/3600)}h`:n<604800?`Il y a ${Math.floor(n/86400)}j`:new Date(s*1e3).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},oe=s=>{if(s<60)return`${s}s`;const i=Math.floor(s/60),n=s%60;return`${i}min ${n}s`},I=s=>s.length===10&&s.startsWith("0")?s.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):s,de=s=>{switch(s){case"incoming":case"accepted":return le;case"outgoing":return ne;case"missed":return ae;default:return j}},ce=s=>{switch(s){case"incoming":case"accepted":return"Entrant";case"outgoing":return"Sortant";case"missed":return"Manqué";default:return s}},me=({call:s,onDelete:i})=>{const[n,t]=u.useState(!1),a=de(s.type),o=s.type==="missed",d=()=>{n?(i(s.id),t(!1)):(t(!0),setTimeout(()=>t(!1),3e3))};return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg transition-colors ${s.new?"bg-blue-900/20 border border-blue-700/50":"bg-[#1a1a1a] hover:bg-[#202020]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${o?"bg-red-500/20 text-red-400":"bg-emerald-500/20 text-emerald-400"}`,children:e.jsx(a,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:s.name||I(s.number)}),s.new&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-blue-500 text-white rounded-full",children:"Nouveau"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:ce(s.type)}),s.duration>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:oe(s.duration)})]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:ie(s.datetime)})]})]})]}),e.jsx("button",{onClick:d,className:`p-2 rounded-lg transition-colors ${n?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"text-gray-500 hover:bg-gray-700 hover:text-white"}`,title:n?"Confirmer la suppression":"Supprimer",children:e.jsx(v,{size:16})})]})},xe=({contact:s,onDelete:i,onEdit:n})=>{const[t,a]=u.useState(!1),o=()=>{t?(i(s.id),a(!1)):(a(!0),setTimeout(()=>a(!1),3e3))};return e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 hover:bg-[#202020] transition-colors cursor-pointer",onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:e.jsx(re,{size:20,className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:s.display_name}),s.company&&e.jsx("p",{className:"text-xs text-gray-500",children:s.company})]})]}),e.jsx("button",{onClick:d=>{d.stopPropagation(),o()},className:`p-2 rounded-lg transition-colors ${t?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"text-gray-500 hover:bg-gray-700 hover:text-white"}`,title:t?"Confirmer la suppression":"Supprimer",children:e.jsx(v,{size:16})})]}),s.numbers&&s.numbers.length>0&&e.jsx("div",{className:"mt-3 space-y-1.5",children:s.numbers.map((d,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{size:12,className:"text-gray-500"}),e.jsx("span",{className:"text-gray-300",children:I(d.number)}),d.type&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",d.type,")"]})]},p))})]})},ue=({isOpen:s,onClose:i,onSave:n,contact:t})=>{const[a,o]=u.useState({first_name:(t==null?void 0:t.first_name)||"",last_name:(t==null?void 0:t.last_name)||"",company:(t==null?void 0:t.company)||"",numbers:(t==null?void 0:t.numbers)||[{number:"",type:"mobile"}]}),[d,p]=u.useState(!1);K.useEffect(()=>{var l;o({first_name:(t==null?void 0:t.first_name)||"",last_name:(t==null?void 0:t.last_name)||"",company:(t==null?void 0:t.company)||"",numbers:(l=t==null?void 0:t.numbers)!=null&&l.length?t.numbers:[{number:"",type:"mobile"}]})},[t]);const w=()=>{o({...a,numbers:[...a.numbers,{number:"",type:"mobile"}]})},C=l=>{o({...a,numbers:a.numbers.filter((c,m)=>m!==l)})},y=(l,c,m)=>{const g=[...a.numbers];g[l]={...g[l],[c]:m},o({...a,numbers:g})},k=async()=>{p(!0);try{await n({first_name:a.first_name,last_name:a.last_name,display_name:`${a.first_name} ${a.last_name}`.trim()||"Sans nom",company:a.company||void 0,numbers:a.numbers.filter(l=>l.number.trim())}),i()}finally{p(!1)}};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-[#151515] w-full max-w-md rounded-2xl border border-gray-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:t?"Modifier le contact":"Nouveau contact"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-800 rounded-lg",children:e.jsx(R,{size:20,className:"rotate-180"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Prénom"}),e.jsx("input",{type:"text",value:a.first_name,onChange:l=>o({...a,first_name:l.target.value}),className:"w-full px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:outline-none",placeholder:"Jean"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Nom"}),e.jsx("input",{type:"text",value:a.last_name,onChange:l=>o({...a,last_name:l.target.value}),className:"w-full px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:outline-none",placeholder:"Dupont"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Entreprise"}),e.jsx("input",{type:"text",value:a.company,onChange:l=>o({...a,company:l.target.value}),className:"w-full px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:outline-none",placeholder:"Optionnel"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Numéros de téléphone"}),e.jsx("button",{onClick:w,className:"text-xs text-blue-400 hover:text-blue-300",children:"+ Ajouter"})]}),e.jsx("div",{className:"space-y-2",children:a.numbers.map((l,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"tel",value:l.number,onChange:m=>y(c,"number",m.target.value),className:"flex-1 px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:outline-none",placeholder:"06 12 34 56 78"}),e.jsxs("select",{value:l.type,onChange:m=>y(c,"type",m.target.value),className:"px-2 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:outline-none",children:[e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"home",children:"Domicile"}),e.jsx("option",{value:"work",children:"Travail"}),e.jsx("option",{value:"fax",children:"Fax"})]}),a.numbers.length>1&&e.jsx("button",{onClick:()=>C(c),className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg",children:e.jsx(v,{size:16})})]},c))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 border-t border-gray-800",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Annuler"}),e.jsxs("button",{onClick:k,disabled:d||!a.first_name&&!a.last_name,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[d&&e.jsx(q,{size:16,className:"animate-spin"}),t?"Modifier":"Créer"]})]})]})}):null},ye=({onBack:s})=>{const{calls:i,contacts:n,isLoading:t,error:a,fetchCalls:o,fetchContacts:d,markCallsAsRead:p,deleteCall:w,deleteAllCalls:C,createContact:y,updateContact:k,deleteContact:l}=G(),{permissions:c,freeboxUrl:m}=H(),g=c.calls===!0,O=c.contacts===!0,[h,P]=u.useState("calls"),[b,U]=u.useState(""),[N,J]=u.useState("all"),[Q,z]=u.useState(!1),[_,S]=u.useState(void 0);u.useEffect(()=>{o(),d()},[o,d]);const D=i.filter(r=>{var x;if(N==="missed"&&r.type!=="missed"||N==="incoming"&&r.type!=="incoming"&&r.type!=="accepted"||N==="outgoing"&&r.type!=="outgoing")return!1;if(b){const f=b.toLowerCase();if(!r.number.includes(f)&&!((x=r.name)!=null&&x.toLowerCase().includes(f)))return!1}return!0}),L=n.filter(r=>{var f,M,E,F;if(!b)return!0;const x=b.toLowerCase();return r.display_name.toLowerCase().includes(x)||((f=r.first_name)==null?void 0:f.toLowerCase().includes(x))||((M=r.last_name)==null?void 0:M.toLowerCase().includes(x))||((E=r.company)==null?void 0:E.toLowerCase().includes(x))||((F=r.numbers)==null?void 0:F.some(Y=>Y.number.includes(x)))}),$=i.filter(r=>r.new).length,V=i.filter(r=>r.type==="missed").length,B=async()=>{await p()},W=async()=>{confirm("Êtes-vous sûr de vouloir supprimer tout l'historique des appels ?")&&await C()};return e.jsxs("div",{className:"min-h-screen bg-[#050505] text-gray-300",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0a]/95 backdrop-blur-sm border-b border-gray-800",children:e.jsx("div",{className:"max-w-[1920px] mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(R,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(j,{size:24,className:"text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Téléphone"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contacts & Journal d'appels"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Rechercher...",value:b,onChange:r=>U(r.target.value),className:"pl-9 pr-4 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-sm text-white placeholder:text-gray-500 focus:outline-none focus:border-emerald-500 w-64"})]})})]})})}),e.jsxs("main",{className:"max-w-[1920px] mx-auto px-4 py-6 pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>P("calls"),className:`px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${h==="calls"?"text-emerald-400 border-emerald-400":"text-gray-400 border-transparent hover:text-white"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:16}),"Journal (",i.length,")",$>0&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-blue-500 text-white rounded-full",children:$})]})}),e.jsx("button",{onClick:()=>P("contacts"),className:`px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${h==="contacts"?"text-blue-400 border-blue-400":"text-gray-400 border-transparent hover:text-white"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{size:16}),"Contacts (",n.length,")"]})})]}),h==="calls"&&i.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[$>0&&e.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:[e.jsx(ee,{size:14}),"Tout marquer lu"]}),e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition-colors",children:[e.jsx(v,{size:14}),"Effacer l'historique"]})]}),h==="contacts"&&e.jsxs("button",{onClick:()=>{S(void 0),z(!0)},className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:[e.jsx(se,{size:14}),"Ajouter"]})]}),h==="calls"&&e.jsx("div",{className:"flex items-center gap-2 mb-4",children:["all","missed","incoming","outgoing"].map(r=>e.jsxs("button",{onClick:()=>J(r),className:`px-3 py-1.5 text-xs rounded-lg border transition-colors ${N===r?"bg-emerald-900/30 border-emerald-700 text-emerald-400":"bg-[#1a1a1a] border-gray-700 text-gray-400 hover:bg-[#252525]"}`,children:[r==="all"&&"Tous",r==="missed"&&`Manqués (${V})`,r==="incoming"&&"Entrants",r==="outgoing"&&"Sortants"]},r))}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-700/50 rounded-xl flex items-center gap-3",children:[e.jsx(te,{className:"text-red-400 flex-shrink-0"}),e.jsx("p",{className:"text-red-400",children:a})]}),t&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(q,{size:32,className:"text-emerald-400 animate-spin"})}),!t&&h==="calls"&&e.jsxs(e.Fragment,{children:[!g&&e.jsx(T,{permission:"calls",freeboxUrl:m}),D.length>0?e.jsx("div",{className:"space-y-2",children:D.map(r=>e.jsx(me,{call:r,onDelete:w},r.id))}):i.length>0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(j,{size:48,className:"text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Aucun résultat"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Aucun appel ne correspond à votre recherche ou filtre."})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(j,{size:48,className:"text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Aucun appel"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Votre journal d'appels est vide. Les appels entrants et sortants apparaîtront ici."})]})]}),!t&&h==="contacts"&&e.jsxs(e.Fragment,{children:[!O&&e.jsx(T,{permission:"contacts",freeboxUrl:m}),L.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:L.map(r=>e.jsx(xe,{contact:r,onDelete:l,onEdit:x=>{S(x),z(!0)}},r.id))}):n.length>0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(A,{size:48,className:"text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Aucun résultat"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Aucun contact ne correspond à votre recherche."})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(A,{size:48,className:"text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Aucun contact"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Vous n'avez pas encore de contacts. Ajoutez-en un pour commencer."})]})]})]}),e.jsx(ue,{isOpen:Q,onClose:()=>{z(!1),S(void 0)},onSave:async r=>{_?await k(_.id,r):await y(r),d()},contact:_})]})};export{ye as PhonePage,ye as default};
