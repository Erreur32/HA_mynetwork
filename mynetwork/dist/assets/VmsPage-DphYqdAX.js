import{f as $,g as G,b as E,j as e}from"./index-D769t3SB.js";import{r as d}from"./vendor-charts-fy94SsLU.js";import{P as I}from"./PermissionBanner-DQzGv1X1.js";import{af as N,S as g,O as S,Y as q,a2 as B,s as y,e as v,n as H,$ as W,r as Y,m as J,H as z,aD as K,R as Q,al as X,a8 as Z}from"./vendor-icons-Wr2_Nvt-.js";import"./vendor-D9iDNHsv.js";import"./vendor-state-CiM9n9np.js";const ee=({status:r})=>{const l={running:{label:"Active",color:"bg-emerald-500/20 text-emerald-400 border-emerald-500/50"},stopped:{label:"Arrêtée",color:"bg-gray-500/20 text-gray-400 border-gray-500/50"},starting:{label:"Démarrage",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/50"},stopping:{label:"Arrêt",color:"bg-orange-500/20 text-orange-400 border-orange-500/50"}},a=l[r]||l.stopped;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full border ${a.color}`,children:a.label})},se=({vm:r,onStart:l,onStop:a,onRestart:o,onConsole:x,onSettings:m,onDelete:h})=>{const n=r.status==="running",c=r.status==="starting"||r.status==="stopping",[i,u]=d.useState(!1),p=()=>{i?(h(),u(!1)):(u(!0),setTimeout(()=>u(!1),3e3))};return e.jsxs("div",{className:"bg-[#121212] rounded-xl border border-gray-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-lg ${n?"bg-emerald-500/20":"bg-gray-700/50"}`,children:e.jsx(g,{size:24,className:n?"text-emerald-400":"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ee,{status:r.status}),e.jsx("span",{className:"text-xs text-gray-500",children:r.os})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[n&&e.jsx("button",{onClick:x,className:"p-2 text-blue-400 hover:bg-blue-900/20 rounded-lg transition-colors",title:"Console",children:e.jsx(Y,{size:18})}),e.jsx("button",{onClick:m,className:"p-2 text-gray-400 hover:bg-gray-700 hover:text-white rounded-lg transition-colors",title:"Paramètres",children:e.jsx(J,{size:18})})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16,className:"text-blue-400"}),e.jsxs("span",{className:"text-gray-400",children:[r.vcpus," vCPU"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:16,className:"text-emerald-400"}),e.jsxs("span",{className:"text-gray-400",children:[Math.round(r.ramTotal*10)/10," Go"]})]}),r.diskTotal>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{size:16,className:"text-cyan-400"}),e.jsxs("span",{className:"text-gray-400",children:[Math.round(r.diskTotal)," Go"]})]})]})}),e.jsx("div",{className:"p-4 pt-0 flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a,disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-red-600/20 hover:bg-red-600/30 disabled:opacity-50 disabled:cursor-not-allowed text-red-400 rounded-lg transition-colors text-sm",children:[e.jsx(K,{size:16}),"Arrêter"]}),e.jsxs("button",{onClick:o,disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-orange-600/20 hover:bg-orange-600/30 disabled:opacity-50 disabled:cursor-not-allowed text-orange-400 rounded-lg transition-colors text-sm",children:[e.jsx(Q,{size:16}),"Redémarrer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:l,disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-sm",children:[e.jsx(X,{size:16}),"Démarrer"]}),e.jsx("button",{onClick:p,disabled:c,className:`px-3 py-2 rounded-lg transition-colors text-sm ${i?"bg-red-600 text-white":"bg-red-600/20 hover:bg-red-600/30 text-red-400"}`,title:i?"Confirmer la suppression":"Supprimer",children:e.jsx(Z,{size:16})})]})})]})},te=({isOpen:r,onClose:l,onCreate:a})=>{const[o,x]=d.useState(""),[m,h]=d.useState("debian"),[n,c]=d.useState(2),[i,u]=d.useState(2),[p,b]=d.useState(20),j=s=>{s.preventDefault(),o.trim()&&(a(o.trim(),m,n,i*1024*1024*1024,p*1024*1024*1024),x(""),l())};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[#121212] rounded-xl border border-gray-800 p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Créer une VM"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Nom de la VM"}),e.jsx("input",{type:"text",value:o,onChange:s=>x(s.target.value),placeholder:"Ma VM",className:"w-full px-4 py-2.5 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:outline-none",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Système d'exploitation"}),e.jsxs("select",{value:m,onChange:s=>h(s.target.value),className:"w-full px-4 py-2.5 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white focus:outline-none focus:outline-none",children:[e.jsx("option",{value:"debian",children:"Debian"}),e.jsx("option",{value:"ubuntu",children:"Ubuntu"}),e.jsx("option",{value:"alpine",children:"Alpine Linux"}),e.jsx("option",{value:"centos",children:"CentOS"}),e.jsx("option",{value:"windows",children:"Windows"}),e.jsx("option",{value:"other",children:"Autre"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"vCPUs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16,className:"text-gray-500"}),e.jsx("select",{value:n,onChange:s=>c(Number(s.target.value)),className:"flex-1 px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white focus:outline-none focus:outline-none",children:[1,2,4,8].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"RAM (Go)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:16,className:"text-gray-500"}),e.jsx("select",{value:i,onChange:s=>u(Number(s.target.value)),className:"flex-1 px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white focus:outline-none focus:outline-none",children:[1,2,4,8,16].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Disque (Go)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{size:16,className:"text-gray-500"}),e.jsx("select",{value:p,onChange:s=>b(Number(s.target.value)),className:"flex-1 px-3 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg text-white focus:outline-none focus:outline-none",children:[10,20,50,100,200].map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"px-6 py-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:"Créer la VM"})]})]})]})}):null},ce=({onBack:r})=>{var C;const{vms:l,systemInfo:a,isLoading:o,error:x,fetchVms:m,fetchSystemInfo:h,startVm:n,stopVm:c}=$(),{supportsVm:i,hasLimitedVmSupport:u,getMaxVms:p,getModelName:b}=G(),{permissions:j,freeboxUrl:s}=E(),V=j.vm===!0,[k,f]=d.useState(!1);d.useEffect(()=>{i()&&(m(),h())},[m,h,i]);const M=async t=>{await n(t)},_=async t=>{await c(t)},D=async t=>{await c(t),setTimeout(()=>n(t),2e3)},P=t=>{window.open("https://mafreebox.freebox.fr/#Fbx.os.app.vm.app","_blank")},A=t=>{window.open("https://mafreebox.freebox.fr/#Fbx.os.app.vm.app","_blank")},O=async t=>{console.log("Delete VM:",t)},R=(t,F,T,L,U)=>{console.log("Create VM:",{name:t,os:F,vcpus:T,memory:L,diskSize:U})},w=l.filter(t=>t.status==="running").length;return i()?e.jsxs("div",{className:"min-h-screen bg-[#050505] text-gray-300",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0a]/95 backdrop-blur-sm border-b border-gray-800",children:e.jsx("div",{className:"max-w-[1920px] mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(N,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(g,{size:24,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white",children:["Machines Virtuelles",u()&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(max ",p(),")"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.length," VM",l.length!==1?"s":""," • ",w," active",w!==1?"s":""]})]})]})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:[e.jsx(S,{size:18}),"Créer une VM"]})]})})}),e.jsxs("main",{className:"max-w-[1920px] mx-auto px-4 py-6 pb-24",children:[!V&&e.jsx(I,{permission:"vm",freeboxUrl:s}),x&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-700/50 rounded-xl flex items-center gap-3",children:[e.jsx(q,{className:"text-red-400 flex-shrink-0"}),e.jsx("p",{className:"text-red-400",children:x})]}),o&&l.length===0&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(B,{size:32,className:"text-purple-400 animate-spin"})}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-[#121212] rounded-xl border border-gray-800",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-4",children:"Ressources VM globales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(y,{size:16,className:"text-emerald-400"}),e.jsx("span",{children:"Mémoire"})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all",style:{width:`${a.total_memory>0?a.used_memory/a.total_memory*100:0}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400",children:[Math.round(a.used_memory/1024*10)/10," / ",Math.round(a.total_memory/1024*10)/10," Go"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(v,{size:16,className:"text-blue-400"}),e.jsx("span",{children:"vCPUs"})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${a.total_cpus>0?a.used_cpus/a.total_cpus*100:0}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400",children:[a.used_cpus," / ",a.total_cpus," alloués"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(H,{size:16,className:"text-purple-400"}),e.jsx("span",{children:"USB Passthrough"})]}),e.jsx("div",{className:`text-sm ${a.usb_used?"text-amber-400":"text-gray-400"}`,children:a.usb_used?"En cours d'utilisation":"Disponible"}),((C=a.usb_ports)==null?void 0:C.length)>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[a.usb_ports.length," port(s) USB"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(g,{size:16,className:"text-purple-400"}),e.jsx("span",{children:"VMs"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[l.filter(t=>t.status==="running").length,e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["/ ",l.length]})]}),e.jsx("div",{className:"text-xs text-gray-400",children:"actives"})]})]})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(t=>e.jsx(se,{vm:t,onStart:()=>M(t.id),onStop:()=>_(t.id),onRestart:()=>D(t.id),onConsole:()=>P(),onSettings:()=>A(),onDelete:()=>O(t.id)},t.id))}):!o&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(g,{size:64,className:"text-gray-600 mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Aucune VM"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md mb-6",children:"Vous n'avez pas encore de machine virtuelle. Créez-en une pour commencer à virtualiser vos serveurs."}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:[e.jsx(S,{size:20}),"Créer ma première VM"]})]}),l.length>0&&e.jsxs("div",{className:"mt-8 p-6 bg-[#121212] rounded-xl border border-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Gestion avancée"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Pour des fonctionnalités avancées comme la console VNC, la création d'images ISO, ou la configuration réseau détaillée, utilisez l'interface Freebox OS."}),e.jsxs("a",{href:"https://mafreebox.freebox.fr/#Fbx.os.app.vm.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:["Ouvrir Freebox OS",e.jsx(W,{size:14})]})]})]}),e.jsx(te,{isOpen:k,onClose:()=>f(!1),onCreate:R})]}):e.jsxs("div",{className:"min-h-screen bg-[#050505] text-gray-300",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0a]/95 backdrop-blur-sm border-b border-gray-800",children:e.jsx("div",{className:"max-w-[1920px] mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(N,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(g,{size:24,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Machines Virtuelles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Non disponible"})]})]})]})})}),e.jsx("main",{className:"max-w-[1920px] mx-auto px-4 py-6 pb-24",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-amber-500/10 flex items-center justify-center mb-6",children:e.jsx(g,{size:40,className:"text-amber-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"VMs non disponibles"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md mb-4",children:"Les machines virtuelles ne sont pas supportees sur votre modele de Freebox."}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["Modele detecte : ",e.jsx("span",{className:"text-gray-400",children:b()})]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:[e.jsx(N,{size:20}),"Retour au dashboard"]})]})})]})};export{ce as VmsPage,ce as default};
